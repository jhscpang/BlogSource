---
title: 网站扫码登陆原理
date: 2017-04-03 15:01:58
categories: Web开发
tags: 
    - 二维码
---

## 简介

随着二维码应用的普及，越来越多的网站加入了扫码网站上的二维码进行网站登陆的功能。典型的应用是微信网页版，打开微信网页版，用手机微信扫码网站上的二维码，然后确认登陆，不需要输入用户名和密码即可完成微信网页版的登陆。

出于好奇，作者查找了一些关于扫码登陆的资料，做了一下总结分享出来。其中参考的帖子有如下几个：
http://www.jianshu.com/p/7f072ac61763
https://www.zhihu.com/question/22991085

## 原理

![扫码登陆示意图](/images/201704/扫码登陆示意图.png)

如上图所示，臆想现在的情景是在进行微信网页端扫码登陆，那么交互的过程分如下几步：

  1. 打开微信网页端，服务器会给页面发送一个二维码，二维码里存储的信息实际上就是一个字符串，而微信扫码登陆时二维码解析成字符串是类似这样的：https://login.weixin.qq.com/l/ga9bMbfOGw== 。其中ga9bMbfOGw==是服务器为此次请求生成的唯一标示UUID，并且进行了加密后的样子。（读者可以打开微信网页版，然后把二维码截图，放在[这个二维码解码器工具](http://jiema.wwei.cn/)里查看一下UUID）

  2. 手机扫码二维码，然后解析二维码，能获取到UUID。

  3. 客户端将用户在客户端登陆的信息和UUID同时传给服务器。

  4. 服务器得到UUID和用户信息后，将两者生成登陆签名，然后服务器给浏览器发送一个状态码通知浏览器UUID和用户信息已经绑定了，但是并不给浏览器发登陆签名，浏览器此时显示等待客户端确认登陆。

  5. 客户端点击确认登陆，将用户信息再次传给服务器。

  6. 服务器根据用户信息可以找到登陆签名。发给浏览器完成登陆。

值得一提的是，浏览器和服务器在整个过程中一般使用长连接。并且在浏览器等待客户端扫码时，浏览器会定期轮询给服务器发请求问UUID和用户信息绑定上没，一旦绑定上，服务器端立刻返回结果，如果没绑定上，服务器暂时阻塞，阻塞到一定时间，服务器会给浏览器发一个状态码告诉它没绑定。


  